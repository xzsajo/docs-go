import{_ as i,c as a,a3 as e,o as t}from"./chunks/framework.CAwIQbWu.js";const d=JSON.parse('{"title":"mobileHack","description":"","frontmatter":{},"headers":[],"relativePath":"WebApp/mobileHack.md","filePath":"WebApp/mobileHack.md","lastUpdated":1657266063000}'),n={name:"WebApp/mobileHack.md"};function l(p,s,h,k,r,E){return t(),a("div",null,s[0]||(s[0]=[e(`<h1 id="mobilehack" tabindex="-1">mobileHack <a class="header-anchor" href="#mobilehack" aria-label="Permalink to &quot;mobileHack&quot;">​</a></h1><h3 id="白屏解决与优化方案" tabindex="-1">白屏解决与优化方案 <a class="header-anchor" href="#白屏解决与优化方案" aria-label="Permalink to &quot;白屏解决与优化方案&quot;">​</a></h3><p>当前很多无线页面都是用前端模板进行数据渲染，那么在糟糕的网速情况下，一进去页面，看到的不是白屏就是 loading，这称为白屏问题。</p><p>此问题发生的原因基本可以归结为网速跟静态资源</p><p>1、css 文件加载需要一些时间，在加载的过程中页面是空白的。</p><p>解决：可以考虑将 css 代码前置和内联。</p><p>2、首屏无实际的数据内容，等待异步加载数据在渲染页面导致白屏</p><p>解决：在首页直接同步渲染 html，后续的滚屏等再采用异步请求数据和渲染 html</p><p>3、首屏内联 js 的执行会阻塞页面的渲染。</p><p>解决：尽量不在首屏 html 代码中房子内联脚本</p><h4 id="解决方案" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案" aria-label="Permalink to &quot;解决方案&quot;">​</a></h4><p>根本原因是客户端渲染的无力，因此最简单的方法是咋服务器端，使用模板引起渲染所有页面。同时</p><p>1 减少文件加载体积，如 html 压缩，js 压缩</p><p>2 加快 js 执行速度，比如常见的无限滚动的页面，可以使用 js 先渲染一个屏幕范围内的东西</p><p>3 提高一些优化的交互，比如提供一些假的滚动条</p><p>4 使用本地存储处理静态文件</p><h3 id="如何实现打开已安装的-app-若未安装则引导用户安装" tabindex="-1">如何实现打开已安装的 app，若未安装则引导用户安装？ <a class="header-anchor" href="#如何实现打开已安装的-app-若未安装则引导用户安装" aria-label="Permalink to &quot;如何实现打开已安装的 app，若未安装则引导用户安装？&quot;">​</a></h3><p>来自 <a href="http://gallery.kissyui.com/redirectToNative/1.2/guide/index.html" target="_blank" rel="noreferrer">http://gallery.kissyui.com/redirectToNative/1.2/guide/index.html</a> kissy mobile 通过 iframe src 发送请求打开 app，自定义 url scheme，如 taobao://home(淘宝首页)、etao://scan（一淘扫描）;如果安装了客户端则会直接唤起，直接唤起后，之前浏览器窗口（或者扫码工具的 webview）推入后台；如果在指定的时间内客户端没有被唤起，则 js 重定向到 app 下载地址。大概实现代码如下</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">goToNative</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">body) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            document.body.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">appendChild</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(iframe);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        body.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">appendChild</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(iframe)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    document.body.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">removeChild</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(iframe);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    gotoDownload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(stratTime) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 去下载，下载链接一般是 itunes app store 或者 apk 文件链接</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   	// 测试时间设置小于800ms时，在android下的UC浏览器会打开native appp时并下载apk，</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 测试android+UC下打开native的时候最好大于800ms</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">800</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>需要注意的是 如果是 android chrome 25 版本以后，在 iframe src 不会发送请求，原因如下 <a href="https://developers.google.com/chrome/mobile/docs/intents" target="_blank" rel="noreferrer">https://developers.google.com/chrome/mobile/docs/intents</a> ，通过 loacation href 使用 intent 机制拉起客户端可行并且当前页面不跳转</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window.location </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;intent://&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    schemeUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;#Intent;scheme=&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    scheme </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;;package=&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    self.package </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;;end&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h2 id="神奇的-iframe" tabindex="-1">神奇的 iframe <a class="header-anchor" href="#神奇的-iframe" aria-label="Permalink to &quot;神奇的 iframe&quot;">​</a></h2><p>Flutter 开发的App引用，打开企业微信客服，返回时会白屏</p><p>起初用的是 location.href</p><p>例如</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">location.href </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;https://work.weixin.qq.com/kfid/xxx&#39;</span></span></code></pre></div><p>不行，后来同事用 iframe 打开可以</p><p>我很惊讶，iframe 不是嵌入代码吗，怎么能打开，于是向同事要了代码</p><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">iframe</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;iframe&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> frameborder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> style</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;opacity: 0;position: absolute;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">iframe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> iframe</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;iframe&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  iframe.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setAttribute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;src&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;https://work.weixin.qq.com/kfid/xxxx&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><p>神奇，给 iframe 赋值，竟然能唤起企业微信</p><p>这不 hack 吗</p><h2 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-label="Permalink to &quot;参考资料&quot;">​</a></h2><ul><li><a href="https://js8.in/2013/12/16/ios%E4%BD%BF%E7%94%A8schema%E5%8D%8F%E8%AE%AE%E8%B0%83%E8%B5%B7app/" target="_blank" rel="noreferrer">iOS 使用 scheme 协议调起 APP</a></li><li><a href="https://github.com/RubyLouvre/mobileHack" target="_blank" rel="noreferrer">司徒正美的 mobileHack</a></li><li><a href="https://github.com/suoyuesmile/suo-blog/blob/master/articals/h5/0003.md" target="_blank" rel="noreferrer">12 个前端必会 H5 问题及解决方法</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzk0MDMwMzQyOA==&amp;mid=2247490207&amp;idx=1&amp;sn=82e08108f953fa541304b8bfc318fb30&amp;source=41#wechat_redirect" target="_blank" rel="noreferrer">微信 H5 页面兼容性解决方案</a></li><li><a href="https://github.com/yunzhijia/front-end/blob/master/web%20app%E9%97%AE%E9%A2%98%E5%8F%8A%E6%8A%80%E5%B7%A7%E6%80%BB%E7%BB%93.md" target="_blank" rel="noreferrer">web app 问题及技巧总结</a></li><li><a href="https://github.com/jtyjty99999/mobileTech" target="_blank" rel="noreferrer">mobileTech</a></li><li><a href="https://www.open-open.com/lib/view/open1449325854077.html" target="_blank" rel="noreferrer">H5 项目常见问题汇总及解决方案</a></li><li><a href="https://github.com/suoyuesmile/suo-blog/blob/master/articals/h5/0003.md" target="_blank" rel="noreferrer">移动端 H5 相关问题汇总</a></li><li><a href="https://juejin.cn/post/6844903615304302600" target="_blank" rel="noreferrer">如何写一个适配 iPhoneX 的底部导航</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzk0MDMwMzQyOA==&amp;mid=2247490207&amp;idx=1&amp;sn=82e08108f953fa541304b8bfc318fb30&amp;source=41#wechat_redirect" target="_blank" rel="noreferrer">微信 H5 页面兼容性解决方案</a></li><li><a href="https://juejin.cn/post/6844903940190896135" target="_blank" rel="noreferrer">微信浏览器禁止页面下拉查看网址</a></li><li><a href="http://www.imooc.com/article/260139" target="_blank" rel="noreferrer">移动 web 开发踩坑总结</a></li><li><a href="https://segmentfault.com/a/1190000012761272" target="_blank" rel="noreferrer">iOS Safari 浏览器上 overflow: scroll 元素无法滑动 bug 解决方法整理</a></li><li><a href="https://segmentfault.com/a/1190000016408566" target="_blank" rel="noreferrer">iOS safari 浏览器上 overflow: scroll 元素无法滚动 bug 深究</a></li></ul>`,33)]))}const c=i(n,[["render",l]]);export{d as __pageData,c as default};
