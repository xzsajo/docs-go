import{_ as a,c as e,a3 as i,o as l}from"./chunks/framework.CAwIQbWu.js";const c=JSON.parse('{"title":"实战：serverless-vercel","description":"","frontmatter":{},"headers":[],"relativePath":"Node/应用开发/实战：serverless-vercel.md","filePath":"Node/应用开发/实战：serverless-vercel.md","lastUpdated":1736435697000}'),t={name:"Node/应用开发/实战：serverless-vercel.md"};function n(h,s,r,p,k,d){return l(),e("div",null,s[0]||(s[0]=[i(`<h1 id="实战-serverless-vercel" tabindex="-1">实战：serverless-vercel <a class="header-anchor" href="#实战-serverless-vercel" aria-label="Permalink to &quot;实战：serverless-vercel&quot;">​</a></h1><p>这里我们讲一下 serverless 的极简服务</p><h2 id="新建项目" tabindex="-1">新建项目 <a class="header-anchor" href="#新建项目" aria-label="Permalink to &quot;新建项目&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span></code></pre></div><h2 id="新建-api-index" tabindex="-1">新建 api/index <a class="header-anchor" href="#新建-api-index" aria-label="Permalink to &quot;新建 api/index&quot;">​</a></h2><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;world&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.query;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`Hello \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}!\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="使用命令行-vercel" tabindex="-1">使用命令行 vercel <a class="header-anchor" href="#使用命令行-vercel" aria-label="Permalink to &quot;使用命令行 vercel&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vercel</span></span></code></pre></div><p>跟着提示一路执行下来</p><p>此时，访问 <a href="https://serverless-vercel-lac.vercel.app/api" target="_blank" rel="noreferrer">https://serverless-vercel-lac.vercel.app/api</a> ，就能直接访问到，在 url后加上<code>?name=johan</code>，即 <a href="https://serverless-vercel-lac.vercel.app/api?name=johan" target="_blank" rel="noreferrer">https://serverless-vercel-lac.vercel.app/api?name=johan</a> ，就能看到应用显示<code>Hello, johan</code></p><p>但访问根目录，即 <a href="https://serverless-vercel-lac.vercel.app" target="_blank" rel="noreferrer">https://serverless-vercel-lac.vercel.app</a>，报404</p><p>我们编写 vercel.json 解决这个问题</p><h3 id="新建-vercel-json-并编写" tabindex="-1">新建 vercel.json 并编写 <a class="header-anchor" href="#新建-vercel-json-并编写" aria-label="Permalink to &quot;新建 vercel.json 并编写&quot;">​</a></h3><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;rewrites&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;source&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;destination&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/index&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><blockquote><p>最新的版本是3，相关文档：<a href="https://vercel.com/docs/build-output-api/v3" target="_blank" rel="noreferrer">https://vercel.com/docs/build-output-api/v3</a></p></blockquote><h2 id="本地调试" tabindex="-1">本地调试 <a class="header-anchor" href="#本地调试" aria-label="Permalink to &quot;本地调试&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vercel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span></span></code></pre></div><p>发现访问根目录能直接跳转至<code>api/index</code> 文件，成功</p><h2 id="第二个serveless" tabindex="-1">第二个serveless <a class="header-anchor" href="#第二个serveless" aria-label="Permalink to &quot;第二个serveless&quot;">​</a></h2><p>在 api 文件夹中，文件即服务</p><h2 id="新建-date-js-并编写" tabindex="-1">新建 date.js 并编写 <a class="header-anchor" href="#新建-date-js-并编写" aria-label="Permalink to &quot;新建 date.js 并编写&quot;">​</a></h2><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`当前时间 \${</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toISOString</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>文件目录</p><p><img src="https://s2.loli.net/2023/06/07/j7FS1xkneGdiEaD.png" alt="文件目录"></p><h2 id="连接-git" tabindex="-1">连接 git <a class="header-anchor" href="#连接-git" aria-label="Permalink to &quot;连接 git&quot;">​</a></h2><p>与 <a href="https://docs-go.vercel.app/node/express/%E5%AE%9E%E6%88%98%EF%BC%9A%E5%A6%82%E4%BD%95%E5%B0%86%20Express%20API%20%E9%83%A8%E7%BD%B2%E5%88%B0%20Vercel.html" target="_blank" rel="noreferrer">实战：如何将 Express API 部署到 Vercel</a> 流程一致</p><h2 id="再次部署" tabindex="-1">再次部署 <a class="header-anchor" href="#再次部署" aria-label="Permalink to &quot;再次部署&quot;">​</a></h2><p>vercel 重新部署到新的预览页面</p><p>vercel --prod：部署生产环境</p><h2 id="项目地址" tabindex="-1">项目地址 <a class="header-anchor" href="#项目地址" aria-label="Permalink to &quot;项目地址&quot;">​</a></h2><p>源码：<a href="https://github.com/johanazhu/serverless-vercel" target="_blank" rel="noreferrer">https://github.com/johanazhu/serverless-vercel</a></p><p>网站：<a href="https://serverless-vercel-lac.vercel.app/" target="_blank" rel="noreferrer">https://serverless-vercel-lac.vercel.app/</a></p><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><p>实现 vercel 上部署 serverless 的小 demo，后续会有大一点的实战</p><h2 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-label="Permalink to &quot;参考资料&quot;">​</a></h2><ul><li><a href="https://vercel.com/guides/using-express-with-vercel" target="_blank" rel="noreferrer">using-express-with-vercel</a></li><li><a href="https://vercel.com/docs/concepts/projects/project-configuration" target="_blank" rel="noreferrer">vercel.json文档</a></li></ul>`,36)]))}const E=a(t,[["render",n]]);export{c as __pageData,E as default};
